const hamburger = document.querySelector(".hamburger");
const menu = document.querySelector(".opened__menu");
const close = document.querySelector(".close-icon");
const body = document.querySelector("body");
const menuList = document.querySelector(".menu__list--opened");

hamburger.addEventListener("click", function(event) {
  event.preventDefault();
  menu.classList.add("opened__menu--active");
  body.classList.add("noscroll");
});

close.addEventListener("click", function(event) {
  menu.classList.remove("opened__menu--active");
  body.classList.remove("noscroll");
});

menuList.addEventListener("click", function(event) {
  event.preventDefault();
  menu.classList.remove("opened__menu--active");
  body.classList.remove("noscroll");
});


;const openItem = item => {
  const container = item.closest(".team__item");
  const contentBlock = container.find(".team__content");
  const textBlock = contentBlock.find(".team__content-block");
  const reqHeight = textBlock.height();

  container.addClass("active");
  contentBlock.height(reqHeight);
};

const closeEveryItem = container => {
  const items = container.find(".team__content");
  const itemContainer = container.find(".team__item");

  itemContainer.removeClass("active");
  items.height(0);
};


$('.team__title').click (e => {
  const $this = $(e.currentTarget);
  const container = $this.closest('.team');
  const elemContainer = $this.closest(".team__item");

  if (elemContainer.hasClass("active")) {
    closeEveryItem(container);
  } else { 
    closeEveryItem(container);
    openItem($this);
  }
});;  
(function () {
  let myMap;
  
  const init = () => {
    myMap = new ymaps.Map("map", {
      center: [55.661689, 37.747406],
      zoom: 16,
      controls: ['zoomControl']
    });
  
    const coords = [
      [55.661562, 37.744073],
      [55.664009, 37.743813],
      [55.659647, 37.749661],
      [55.662750, 37.747100]
    ];
  
    var myCollection = new ymaps.GeoObjectCollection({}, {
      draggable: false,
      iconLayout: 'default#image',
      iconImageHref: './images/mark.png',
      iconImageSize: [46, 57],
      iconImageOffset: [-21, -60]
    });
  
    coords.forEach(coord => {
      myCollection.add(new ymaps.Placemark(coord))
    });
  
    myMap.geoObjects.add(myCollection);
  
    myMap.behaviors.disable('scrollZoom');
  }
  
  ymaps.ready(init);
  
  }());;const mesureWidth = item => {
  let reqItemWidth = 0;
  const screenWidth = $(window).width();
  const container = item.closest(".products-menu");
  const titlesBlocks = container.find(".products-menu__title");
  const titlesWidth = titlesBlocks.width() * titlesBlocks.length;

  const textContainer = item.find(".products-menu__container");
  const paddingLeft = parseInt(textContainer.css("padding-left"));
  const paddingRight = parseInt(textContainer.css("padding-right"));

  const isMobile = window.matchMedia("(max-width: 768px)").matches;

  if (isMobile) {
    reqItemWidth = screenWidth - titlesWidth;
  } else {
    reqItemWidth = 500;  
  }

  return {
    container: reqItemWidth,
    textContainer: reqItemWidth - paddingRight - paddingLeft
  }
};

const closeEveryItemInContainer = (container) => {
  const items = container.find(".products-menu__item");
  const content = container.find (".products-menu__content");

  items.removeClass("active");
  content.width(0);
};

const openingItem = item => {
  const hiddenContent = item.find(".products-menu__content");
  const reqWidth = mesureWidth(item);
  const textBlock = item.find(".products-menu__container");

  item.addClass("active");
  hiddenContent.width(reqWidth.container);
  textBlock.width(reqWidth.textContainer);
};

$(".products-menu__title").on("click", (e) => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const item = $this.closest(".products-menu__item");
  const itemOpened = item.hasClass("active");
  const container = $this.closest(".products-menu");

  if (itemOpened) {
    closeEveryItemInContainer(container)
  } else {
    closeEveryItemInContainer(container)
    openingItem(item);
  }
});

$(".products-menu__close").on("click", (e) => {
  e.preventDefault();

  closeEveryItemInContainer($(".products-menu"));
});;const validateFields = (form, fieldsArray) => {
  
  fieldsArray.forEach((field) => {
    field.removeClass("input-error");
    if(field.val().trim()== "") {
      field.addClass("input-error");
    }
  });

  const errorFields = form.find('.input-error');

  return errorFields.length == 0;
}
$('.form').submit((e)=> {
  e.preventDefault();

  const form = $(e.currentTarget);
  const name = form.find("[name='name']");
  const phone = form.find("[name='phone']");
  const comment = form.find("[name='comment']");
  const to = form.find("[name='to']");

  const modal = $("#modal");
  const content = modal.find("modal__content")

  const isValid = validateFields(form, [name, phone, comment, to]);

  modal.removeClass("error-modal");
  
  if(isValid) {
   const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val()
      },
    });

    request.done((data) => {
      content.text(data.message);
      });

    request.fail((data) => {   
      const message = data.responseJSON.message;
      content.text(message);
      modal.addClass("error-modal");
    });

    request.always(() => {
      $.fancybox.open({
        src: "#modal",
        type: "inline",
          
      });
    });
   }
});

$('.button-close').click(e => { 
  e.preventDefault();

  const form = $(e.currentTarget);

  $.fancybox.close();
  
  $('#form')[0].reset();
});

;const sections = $("section");
const display = $(".maincontent");
const sideMenu = $(".fixed-menu");
const menuItems = sideMenu.find("fixed-menu__item");

let inScroll = false;

const countSectionPosition = sectionEq => {
  return sectionEq * -100;
}

const changeMenuThemeForSection = (sectionEq) => {
  const currentSection = sections.eq(sectionEq);
  const menuTheme = currentSection.attr("data-sidemenu-theme");
  const activeClass = "fixed-menu--shadowed";


    if (menuTheme == "black") {
      sideMenu.addClass(activeClass);
    } else {
      sideMenu.removeClass(activeClass);
    }

}

const resetActiveClassForItem = (items, itemEq, activeClass) => {
  items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
}

const performTransition = (sectionEq) => {
  if(inScroll) return;
    
  const transitionOver = 1000;
  const mouseInertiaOver = 300;

    inScroll = true;
    
    const position = countSectionPosition(sectionEq);

    changeMenuThemeForSection(sectionEq);

    display.css({
      transform: `translateY(${position}%)`,
    });

   resetActiveClassForItem(sections, sectionEq, "active");

   /*sections.eq(sectionEq).addClass("active").siblings().removeClass("active");*/

   sideMenu.find(".fixed-menu__item").eq(sectionEq).addClass("fixed-menu__item--active").siblings().removeClass("fixed-menu__item--active");

   setTimeout(() => {
    inScroll = false;
    resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");
   }, transitionOver + mouseInertiaOver);
 
};

const scrollViewport = (direction) => {
  const activeSection = sections.filter(".active"); 
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  if (direction == "next" && nextSection.length) {
    performTransition(nextSection.index());
  }

  if (direction == "prev" && prevSection.length) {
    performTransition(prevSection.index());
  }
};

$(window).on("wheel", (e) => {
  const deltaY = e.originalEvent.deltaY;

  if (deltaY > 0) {
    
    scrollViewport("next");
  }

  if (deltaY < 0) {

    scrollViewport("prev");
  }
});

$(window).on("keydown", (e) => {

  const tagName = e.target.tagName.toLowerCase();
  const userTypingInputs = tagName == "input" || tagName == "textarea";

  if (userTypingInputs) return; 
    switch (e.keyCode) {
      case 38:
        scrollViewport("prev");
        break;
    
        case 40:
        scrollViewport("next");
        break;
   }
});

$("[data-scroll-to]").click(e =>{
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr("data-scroll-to");
  const reqSection = $(`[data-section-id=${target}]`);

  performTransition(reqSection.index());


});;let player;
const playerContainer = $('.player');
const playerStart = $('.player__start');
const volumeBtn = $(".volume__pic");


let eventsInit = () => {
    $(".player__start").click(e => {
        e.preventDefault();

        const btn = $(e.currentTarget);

        if (playerStart.hasClass("player--paused")){

            
            player.pauseVideo();

        }else{
            
            player.playVideo();
        }
        
        onPlayerReady();
    });

    $(".player__playback").click(e => {
        const bar = $(e.currentTarget);
        const clickedPosition = e.originalEvent.layerX;
        const newButtonPositionPercent = (clickedPosition / bar.width()) * 100;
        const newPlaybackPositionSec = 
            (player.getDuration() / 100) * newButtonPositionPercent;


        $(".player__playback-button").css({
            left: `${newButtonPositionPercent}%`
        });

        player.seekTo(newPlaybackPositionSec);
    });

    $(".player__splash__play").click(e => {
        player.playVideo();
    });


    $(".volume__pic").click(e => {
        e.preventDefault();

        if (volumeBtn.hasClass("volume__pic--nosound")){

            player.unMute();
            volumeBtn.removeClass("volume__pic--nosound");

        }else{
            
            player.mute();
            volumeBtn.addClass("volume__pic--nosound");
        }
    });

    $(".volume__playback").click(e => {

        const barVolume = $(e.currentTarget);
        const clickedPositionVolume = e.originalEvent.layerX;
        const newVolumeButtonPositionPercent = (clickedPositionVolume / barVolume.width()) * 100;
        let volumePoint = player.getVolume();
    
    
        $(".volume__playback-button").css({
            left: `${newVolumeButtonPositionPercent}%`
        });

        player.setVolume(newVolumeButtonPositionPercent);
        
    });

    
};


const onPlayerReady = () => {
    let interval;
    const durationSec = player.getDuration();

    if (typeof interval !== "undefined"){
        clearInterval(interval);
    }

    interval = setInterval(() => {
        const completedSec = player.getCurrentTime();
        const completedPercent = (completedSec / durationSec) * 100;

        $(".player__playback-button").css({
            left: `${completedPercent}%`
        });

    }, 1000);
};


const onPlayerStateChange = event => {
    switch(event.data){
        case 1:
            playerContainer.addClass("active");
            playerStart.addClass("player--paused");
            break;
        case 2:
            playerContainer.removeClass("active");
            playerStart.removeClass("player--paused");
            break;
    }
}

function onYouTubeIframeAPIReady() {
    player = new YT.Player('yt-player', {
        height: '405',
        width: '660',
        videoId: 'LXb3EKWsInQ',
        events:{
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
        },
        playerVars: {
            controls: 0,
            disablekb: 0,
            showinfo: 0,
            rel: 0,
            autoplay: 0,
            modesbranding: 0
        }
    })
};


eventsInit();;const slider = $(".slider").bxSlider({
  pager: false,
  controls: false
});

$(".arrow-left").click((e) => {

  slider.goToPrevSlide();

});

$(".arrow-right").click((e) => {

  slider.goToNextSlide();

});;const findBlockByAlias = (alias) => {
  return $(".reviews-item").filter((ndx, item) => {
    return $(item).attr("data-linked-with") == alias;
  });
};
$(".reviews-switcher__link").click((e) => { 
  e.preventDefault();


  const $this = $(e.currentTarget);
  const target = $this.attr("data-open");
  const itemToShow = findBlockByAlias(target);
  const curItem = $this.closest(".reviews-switcher__item");


  itemToShow.addClass("active").siblings().removeClass("active");
  curItem.addClass("active").siblings().removeClass("active");
}); 
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjEuanMiLCJhY2NvLmpzIiwibWFwLmpzIiwibWVudS1hY2NvLmpzIiwibW9kYWwuanMiLCJvcHMuanMiLCJwbGF5ZXIuanMiLCJzbGlkZXIuanMiLCJ0YWJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDeEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElDOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUMvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ2pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0N0SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBoYW1idXJnZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmhhbWJ1cmdlclwiKTtcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm9wZW5lZF9fbWVudVwiKTtcbmNvbnN0IGNsb3NlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jbG9zZS1pY29uXCIpO1xuY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJib2R5XCIpO1xuY29uc3QgbWVudUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1lbnVfX2xpc3QtLW9wZW5lZFwiKTtcblxuaGFtYnVyZ2VyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbihldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBtZW51LmNsYXNzTGlzdC5hZGQoXCJvcGVuZWRfX21lbnUtLWFjdGl2ZVwiKTtcbiAgYm9keS5jbGFzc0xpc3QuYWRkKFwibm9zY3JvbGxcIik7XG59KTtcblxuY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gIG1lbnUuY2xhc3NMaXN0LnJlbW92ZShcIm9wZW5lZF9fbWVudS0tYWN0aXZlXCIpO1xuICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJub3Njcm9sbFwiKTtcbn0pO1xuXG5tZW51TGlzdC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgbWVudS5jbGFzc0xpc3QucmVtb3ZlKFwib3BlbmVkX19tZW51LS1hY3RpdmVcIik7XG4gIGJvZHkuY2xhc3NMaXN0LnJlbW92ZShcIm5vc2Nyb2xsXCIpO1xufSk7XG5cblxuIiwiY29uc3Qgb3Blbkl0ZW0gPSBpdGVtID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnRlYW1fX2l0ZW1cIik7XG4gIGNvbnN0IGNvbnRlbnRCbG9jayA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2NvbnRlbnRcIik7XG4gIGNvbnN0IHRleHRCbG9jayA9IGNvbnRlbnRCbG9jay5maW5kKFwiLnRlYW1fX2NvbnRlbnQtYmxvY2tcIik7XG4gIGNvbnN0IHJlcUhlaWdodCA9IHRleHRCbG9jay5oZWlnaHQoKTtcblxuICBjb250YWluZXIuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gIGNvbnRlbnRCbG9jay5oZWlnaHQocmVxSGVpZ2h0KTtcbn07XG5cbmNvbnN0IGNsb3NlRXZlcnlJdGVtID0gY29udGFpbmVyID0+IHtcbiAgY29uc3QgaXRlbXMgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xuICBjb25zdCBpdGVtQ29udGFpbmVyID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9faXRlbVwiKTtcblxuICBpdGVtQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICBpdGVtcy5oZWlnaHQoMCk7XG59O1xuXG5cbiQoJy50ZWFtX190aXRsZScpLmNsaWNrIChlID0+IHtcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoJy50ZWFtJyk7XG4gIGNvbnN0IGVsZW1Db250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnRlYW1fX2l0ZW1cIik7XG5cbiAgaWYgKGVsZW1Db250YWluZXIuaGFzQ2xhc3MoXCJhY3RpdmVcIikpIHtcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xuICB9IGVsc2UgeyBcbiAgICBjbG9zZUV2ZXJ5SXRlbShjb250YWluZXIpO1xuICAgIG9wZW5JdGVtKCR0aGlzKTtcbiAgfVxufSk7IiwiICBcbihmdW5jdGlvbiAoKSB7XG4gIGxldCBteU1hcDtcbiAgXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XG4gICAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcbiAgICAgIGNlbnRlcjogWzU1LjY2MTY4OSwgMzcuNzQ3NDA2XSxcbiAgICAgIHpvb206IDE2LFxuICAgICAgY29udHJvbHM6IFsnem9vbUNvbnRyb2wnXVxuICAgIH0pO1xuICBcbiAgICBjb25zdCBjb29yZHMgPSBbXG4gICAgICBbNTUuNjYxNTYyLCAzNy43NDQwNzNdLFxuICAgICAgWzU1LjY2NDAwOSwgMzcuNzQzODEzXSxcbiAgICAgIFs1NS42NTk2NDcsIDM3Ljc0OTY2MV0sXG4gICAgICBbNTUuNjYyNzUwLCAzNy43NDcxMDBdXG4gICAgXTtcbiAgXG4gICAgdmFyIG15Q29sbGVjdGlvbiA9IG5ldyB5bWFwcy5HZW9PYmplY3RDb2xsZWN0aW9uKHt9LCB7XG4gICAgICBkcmFnZ2FibGU6IGZhbHNlLFxuICAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxuICAgICAgaWNvbkltYWdlSHJlZjogJy4vaW1hZ2VzL21hcmsucG5nJyxcbiAgICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxuICAgICAgaWNvbkltYWdlT2Zmc2V0OiBbLTIxLCAtNjBdXG4gICAgfSk7XG4gIFxuICAgIGNvb3Jkcy5mb3JFYWNoKGNvb3JkID0+IHtcbiAgICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZCkpXG4gICAgfSk7XG4gIFxuICAgIG15TWFwLmdlb09iamVjdHMuYWRkKG15Q29sbGVjdGlvbik7XG4gIFxuICAgIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKCdzY3JvbGxab29tJyk7XG4gIH1cbiAgXG4gIHltYXBzLnJlYWR5KGluaXQpO1xuICBcbiAgfSgpKTsiLCJjb25zdCBtZXN1cmVXaWR0aCA9IGl0ZW0gPT4ge1xuICBsZXQgcmVxSXRlbVdpZHRoID0gMDtcbiAgY29uc3Qgc2NyZWVuV2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnByb2R1Y3RzLW1lbnVcIik7XG4gIGNvbnN0IHRpdGxlc0Jsb2NrcyA9IGNvbnRhaW5lci5maW5kKFwiLnByb2R1Y3RzLW1lbnVfX3RpdGxlXCIpO1xuICBjb25zdCB0aXRsZXNXaWR0aCA9IHRpdGxlc0Jsb2Nrcy53aWR0aCgpICogdGl0bGVzQmxvY2tzLmxlbmd0aDtcblxuICBjb25zdCB0ZXh0Q29udGFpbmVyID0gaXRlbS5maW5kKFwiLnByb2R1Y3RzLW1lbnVfX2NvbnRhaW5lclwiKTtcbiAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctbGVmdFwiKSk7XG4gIGNvbnN0IHBhZGRpbmdSaWdodCA9IHBhcnNlSW50KHRleHRDb250YWluZXIuY3NzKFwicGFkZGluZy1yaWdodFwiKSk7XG5cbiAgY29uc3QgaXNNb2JpbGUgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKS5tYXRjaGVzO1xuXG4gIGlmIChpc01vYmlsZSkge1xuICAgIHJlcUl0ZW1XaWR0aCA9IHNjcmVlbldpZHRoIC0gdGl0bGVzV2lkdGg7XG4gIH0gZWxzZSB7XG4gICAgcmVxSXRlbVdpZHRoID0gNTAwOyAgXG4gIH1cblxuICByZXR1cm4ge1xuICAgIGNvbnRhaW5lcjogcmVxSXRlbVdpZHRoLFxuICAgIHRleHRDb250YWluZXI6IHJlcUl0ZW1XaWR0aCAtIHBhZGRpbmdSaWdodCAtIHBhZGRpbmdMZWZ0XG4gIH1cbn07XG5cbmNvbnN0IGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIgPSAoY29udGFpbmVyKSA9PiB7XG4gIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIucHJvZHVjdHMtbWVudV9faXRlbVwiKTtcbiAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kIChcIi5wcm9kdWN0cy1tZW51X19jb250ZW50XCIpO1xuXG4gIGl0ZW1zLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICBjb250ZW50LndpZHRoKDApO1xufTtcblxuY29uc3Qgb3BlbmluZ0l0ZW0gPSBpdGVtID0+IHtcbiAgY29uc3QgaGlkZGVuQ29udGVudCA9IGl0ZW0uZmluZChcIi5wcm9kdWN0cy1tZW51X19jb250ZW50XCIpO1xuICBjb25zdCByZXFXaWR0aCA9IG1lc3VyZVdpZHRoKGl0ZW0pO1xuICBjb25zdCB0ZXh0QmxvY2sgPSBpdGVtLmZpbmQoXCIucHJvZHVjdHMtbWVudV9fY29udGFpbmVyXCIpO1xuXG4gIGl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gIGhpZGRlbkNvbnRlbnQud2lkdGgocmVxV2lkdGguY29udGFpbmVyKTtcbiAgdGV4dEJsb2NrLndpZHRoKHJlcVdpZHRoLnRleHRDb250YWluZXIpO1xufTtcblxuJChcIi5wcm9kdWN0cy1tZW51X190aXRsZVwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgaXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIucHJvZHVjdHMtbWVudV9faXRlbVwiKTtcbiAgY29uc3QgaXRlbU9wZW5lZCA9IGl0ZW0uaGFzQ2xhc3MoXCJhY3RpdmVcIik7XG4gIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIucHJvZHVjdHMtbWVudVwiKTtcblxuICBpZiAoaXRlbU9wZW5lZCkge1xuICAgIGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIoY29udGFpbmVyKVxuICB9IGVsc2Uge1xuICAgIGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIoY29udGFpbmVyKVxuICAgIG9wZW5pbmdJdGVtKGl0ZW0pO1xuICB9XG59KTtcblxuJChcIi5wcm9kdWN0cy1tZW51X19jbG9zZVwiKS5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKCQoXCIucHJvZHVjdHMtbWVudVwiKSk7XG59KTsiLCJjb25zdCB2YWxpZGF0ZUZpZWxkcyA9IChmb3JtLCBmaWVsZHNBcnJheSkgPT4ge1xuICBcbiAgZmllbGRzQXJyYXkuZm9yRWFjaCgoZmllbGQpID0+IHtcbiAgICBmaWVsZC5yZW1vdmVDbGFzcyhcImlucHV0LWVycm9yXCIpO1xuICAgIGlmKGZpZWxkLnZhbCgpLnRyaW0oKT09IFwiXCIpIHtcbiAgICAgIGZpZWxkLmFkZENsYXNzKFwiaW5wdXQtZXJyb3JcIik7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBlcnJvckZpZWxkcyA9IGZvcm0uZmluZCgnLmlucHV0LWVycm9yJyk7XG5cbiAgcmV0dXJuIGVycm9yRmllbGRzLmxlbmd0aCA9PSAwO1xufVxuJCgnLmZvcm0nKS5zdWJtaXQoKGUpPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgbmFtZSA9IGZvcm0uZmluZChcIltuYW1lPSduYW1lJ11cIik7XG4gIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XG4gIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xuICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lPSd0byddXCIpO1xuXG4gIGNvbnN0IG1vZGFsID0gJChcIiNtb2RhbFwiKTtcbiAgY29uc3QgY29udGVudCA9IG1vZGFsLmZpbmQoXCJtb2RhbF9fY29udGVudFwiKVxuXG4gIGNvbnN0IGlzVmFsaWQgPSB2YWxpZGF0ZUZpZWxkcyhmb3JtLCBbbmFtZSwgcGhvbmUsIGNvbW1lbnQsIHRvXSk7XG5cbiAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcbiAgXG4gIGlmKGlzVmFsaWQpIHtcbiAgIGNvbnN0IHJlcXVlc3QgPSAkLmFqYXgoe1xuICAgICAgdXJsOiBcImh0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbFwiLFxuICAgICAgbWV0aG9kOiBcInBvc3RcIixcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbmFtZTogbmFtZS52YWwoKSxcbiAgICAgICAgcGhvbmU6IHBob25lLnZhbCgpLFxuICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxuICAgICAgICB0bzogdG8udmFsKClcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXF1ZXN0LmRvbmUoKGRhdGEpID0+IHtcbiAgICAgIGNvbnRlbnQudGV4dChkYXRhLm1lc3NhZ2UpO1xuICAgICAgfSk7XG5cbiAgICByZXF1ZXN0LmZhaWwoKGRhdGEpID0+IHsgICBcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xuICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xuICAgICAgbW9kYWwuYWRkQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcbiAgICB9KTtcblxuICAgIHJlcXVlc3QuYWx3YXlzKCgpID0+IHtcbiAgICAgICQuZmFuY3lib3gub3Blbih7XG4gICAgICAgIHNyYzogXCIjbW9kYWxcIixcbiAgICAgICAgdHlwZTogXCJpbmxpbmVcIixcbiAgICAgICAgICBcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgfVxufSk7XG5cbiQoJy5idXR0b24tY2xvc2UnKS5jbGljayhlID0+IHsgXG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBmb3JtID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuXG4gICQuZmFuY3lib3guY2xvc2UoKTtcbiAgXG4gICQoJyNmb3JtJylbMF0ucmVzZXQoKTtcbn0pO1xuXG4iLCJjb25zdCBzZWN0aW9ucyA9ICQoXCJzZWN0aW9uXCIpO1xuY29uc3QgZGlzcGxheSA9ICQoXCIubWFpbmNvbnRlbnRcIik7XG5jb25zdCBzaWRlTWVudSA9ICQoXCIuZml4ZWQtbWVudVwiKTtcbmNvbnN0IG1lbnVJdGVtcyA9IHNpZGVNZW51LmZpbmQoXCJmaXhlZC1tZW51X19pdGVtXCIpO1xuXG5sZXQgaW5TY3JvbGwgPSBmYWxzZTtcblxuY29uc3QgY291bnRTZWN0aW9uUG9zaXRpb24gPSBzZWN0aW9uRXEgPT4ge1xuICByZXR1cm4gc2VjdGlvbkVxICogLTEwMDtcbn1cblxuY29uc3QgY2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcbiAgY29uc3QgY3VycmVudFNlY3Rpb24gPSBzZWN0aW9ucy5lcShzZWN0aW9uRXEpO1xuICBjb25zdCBtZW51VGhlbWUgPSBjdXJyZW50U2VjdGlvbi5hdHRyKFwiZGF0YS1zaWRlbWVudS10aGVtZVwiKTtcbiAgY29uc3QgYWN0aXZlQ2xhc3MgPSBcImZpeGVkLW1lbnUtLXNoYWRvd2VkXCI7XG5cblxuICAgIGlmIChtZW51VGhlbWUgPT0gXCJibGFja1wiKSB7XG4gICAgICBzaWRlTWVudS5hZGRDbGFzcyhhY3RpdmVDbGFzcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNpZGVNZW51LnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcbiAgICB9XG5cbn1cblxuY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcbiAgaXRlbXMuZXEoaXRlbUVxKS5hZGRDbGFzcyhhY3RpdmVDbGFzcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XG59XG5cbmNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xuICBpZihpblNjcm9sbCkgcmV0dXJuO1xuICAgIFxuICBjb25zdCB0cmFuc2l0aW9uT3ZlciA9IDEwMDA7XG4gIGNvbnN0IG1vdXNlSW5lcnRpYU92ZXIgPSAzMDA7XG5cbiAgICBpblNjcm9sbCA9IHRydWU7XG4gICAgXG4gICAgY29uc3QgcG9zaXRpb24gPSBjb3VudFNlY3Rpb25Qb3NpdGlvbihzZWN0aW9uRXEpO1xuXG4gICAgY2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbihzZWN0aW9uRXEpO1xuXG4gICAgZGlzcGxheS5jc3Moe1xuICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYCxcbiAgICB9KTtcblxuICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0oc2VjdGlvbnMsIHNlY3Rpb25FcSwgXCJhY3RpdmVcIik7XG5cbiAgIC8qc2VjdGlvbnMuZXEoc2VjdGlvbkVxKS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpOyovXG5cbiAgIHNpZGVNZW51LmZpbmQoXCIuZml4ZWQtbWVudV9faXRlbVwiKS5lcShzZWN0aW9uRXEpLmFkZENsYXNzKFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJmaXhlZC1tZW51X19pdGVtLS1hY3RpdmVcIik7XG5cbiAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIGluU2Nyb2xsID0gZmFsc2U7XG4gICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0obWVudUl0ZW1zLCBzZWN0aW9uRXEsIFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpO1xuICAgfSwgdHJhbnNpdGlvbk92ZXIgKyBtb3VzZUluZXJ0aWFPdmVyKTtcbiBcbn07XG5cbmNvbnN0IHNjcm9sbFZpZXdwb3J0ID0gKGRpcmVjdGlvbikgPT4ge1xuICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZVwiKTsgXG4gIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XG4gIGNvbnN0IHByZXZTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5wcmV2KCk7XG5cbiAgaWYgKGRpcmVjdGlvbiA9PSBcIm5leHRcIiAmJiBuZXh0U2VjdGlvbi5sZW5ndGgpIHtcbiAgICBwZXJmb3JtVHJhbnNpdGlvbihuZXh0U2VjdGlvbi5pbmRleCgpKTtcbiAgfVxuXG4gIGlmIChkaXJlY3Rpb24gPT0gXCJwcmV2XCIgJiYgcHJldlNlY3Rpb24ubGVuZ3RoKSB7XG4gICAgcGVyZm9ybVRyYW5zaXRpb24ocHJldlNlY3Rpb24uaW5kZXgoKSk7XG4gIH1cbn07XG5cbiQod2luZG93KS5vbihcIndoZWVsXCIsIChlKSA9PiB7XG4gIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XG5cbiAgaWYgKGRlbHRhWSA+IDApIHtcbiAgICBcbiAgICBzY3JvbGxWaWV3cG9ydChcIm5leHRcIik7XG4gIH1cblxuICBpZiAoZGVsdGFZIDwgMCkge1xuXG4gICAgc2Nyb2xsVmlld3BvcnQoXCJwcmV2XCIpO1xuICB9XG59KTtcblxuJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCAoZSkgPT4ge1xuXG4gIGNvbnN0IHRhZ05hbWUgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IHVzZXJUeXBpbmdJbnB1dHMgPSB0YWdOYW1lID09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09IFwidGV4dGFyZWFcIjtcblxuICBpZiAodXNlclR5cGluZ0lucHV0cykgcmV0dXJuOyBcbiAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xuICAgICAgY2FzZSAzODpcbiAgICAgICAgc2Nyb2xsVmlld3BvcnQoXCJwcmV2XCIpO1xuICAgICAgICBicmVhaztcbiAgICBcbiAgICAgICAgY2FzZSA0MDpcbiAgICAgICAgc2Nyb2xsVmlld3BvcnQoXCJuZXh0XCIpO1xuICAgICAgICBicmVhaztcbiAgIH1cbn0pO1xuXG4kKFwiW2RhdGEtc2Nyb2xsLXRvXVwiKS5jbGljayhlID0+e1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoXCJkYXRhLXNjcm9sbC10b1wiKTtcbiAgY29uc3QgcmVxU2VjdGlvbiA9ICQoYFtkYXRhLXNlY3Rpb24taWQ9JHt0YXJnZXR9XWApO1xuXG4gIHBlcmZvcm1UcmFuc2l0aW9uKHJlcVNlY3Rpb24uaW5kZXgoKSk7XG5cblxufSk7IiwibGV0IHBsYXllcjtcbmNvbnN0IHBsYXllckNvbnRhaW5lciA9ICQoJy5wbGF5ZXInKTtcbmNvbnN0IHBsYXllclN0YXJ0ID0gJCgnLnBsYXllcl9fc3RhcnQnKTtcbmNvbnN0IHZvbHVtZUJ0biA9ICQoXCIudm9sdW1lX19waWNcIik7XG5cblxubGV0IGV2ZW50c0luaXQgPSAoKSA9PiB7XG4gICAgJChcIi5wbGF5ZXJfX3N0YXJ0XCIpLmNsaWNrKGUgPT4ge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgY29uc3QgYnRuID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuXG4gICAgICAgIGlmIChwbGF5ZXJTdGFydC5oYXNDbGFzcyhcInBsYXllci0tcGF1c2VkXCIpKXtcblxuICAgICAgICAgICAgXG4gICAgICAgICAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xuXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwbGF5ZXIucGxheVZpZGVvKCk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIG9uUGxheWVyUmVhZHkoKTtcbiAgICB9KTtcblxuICAgICQoXCIucGxheWVyX19wbGF5YmFja1wiKS5jbGljayhlID0+IHtcbiAgICAgICAgY29uc3QgYmFyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICBjb25zdCBjbGlja2VkUG9zaXRpb24gPSBlLm9yaWdpbmFsRXZlbnQubGF5ZXJYO1xuICAgICAgICBjb25zdCBuZXdCdXR0b25Qb3NpdGlvblBlcmNlbnQgPSAoY2xpY2tlZFBvc2l0aW9uIC8gYmFyLndpZHRoKCkpICogMTAwO1xuICAgICAgICBjb25zdCBuZXdQbGF5YmFja1Bvc2l0aW9uU2VjID0gXG4gICAgICAgICAgICAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogbmV3QnV0dG9uUG9zaXRpb25QZXJjZW50O1xuXG5cbiAgICAgICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvblwiKS5jc3Moe1xuICAgICAgICAgICAgbGVmdDogYCR7bmV3QnV0dG9uUG9zaXRpb25QZXJjZW50fSVgXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHBsYXllci5zZWVrVG8obmV3UGxheWJhY2tQb3NpdGlvblNlYyk7XG4gICAgfSk7XG5cbiAgICAkKFwiLnBsYXllcl9fc3BsYXNoX19wbGF5XCIpLmNsaWNrKGUgPT4ge1xuICAgICAgICBwbGF5ZXIucGxheVZpZGVvKCk7XG4gICAgfSk7XG5cblxuICAgICQoXCIudm9sdW1lX19waWNcIikuY2xpY2soZSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICBpZiAodm9sdW1lQnRuLmhhc0NsYXNzKFwidm9sdW1lX19waWMtLW5vc291bmRcIikpe1xuXG4gICAgICAgICAgICBwbGF5ZXIudW5NdXRlKCk7XG4gICAgICAgICAgICB2b2x1bWVCdG4ucmVtb3ZlQ2xhc3MoXCJ2b2x1bWVfX3BpYy0tbm9zb3VuZFwiKTtcblxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcGxheWVyLm11dGUoKTtcbiAgICAgICAgICAgIHZvbHVtZUJ0bi5hZGRDbGFzcyhcInZvbHVtZV9fcGljLS1ub3NvdW5kXCIpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkKFwiLnZvbHVtZV9fcGxheWJhY2tcIikuY2xpY2soZSA9PiB7XG5cbiAgICAgICAgY29uc3QgYmFyVm9sdW1lID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgICAgICBjb25zdCBjbGlja2VkUG9zaXRpb25Wb2x1bWUgPSBlLm9yaWdpbmFsRXZlbnQubGF5ZXJYO1xuICAgICAgICBjb25zdCBuZXdWb2x1bWVCdXR0b25Qb3NpdGlvblBlcmNlbnQgPSAoY2xpY2tlZFBvc2l0aW9uVm9sdW1lIC8gYmFyVm9sdW1lLndpZHRoKCkpICogMTAwO1xuICAgICAgICBsZXQgdm9sdW1lUG9pbnQgPSBwbGF5ZXIuZ2V0Vm9sdW1lKCk7XG4gICAgXG4gICAgXG4gICAgICAgICQoXCIudm9sdW1lX19wbGF5YmFjay1idXR0b25cIikuY3NzKHtcbiAgICAgICAgICAgIGxlZnQ6IGAke25ld1ZvbHVtZUJ1dHRvblBvc2l0aW9uUGVyY2VudH0lYFxuICAgICAgICB9KTtcblxuICAgICAgICBwbGF5ZXIuc2V0Vm9sdW1lKG5ld1ZvbHVtZUJ1dHRvblBvc2l0aW9uUGVyY2VudCk7XG4gICAgICAgIFxuICAgIH0pO1xuXG4gICAgXG59O1xuXG5cbmNvbnN0IG9uUGxheWVyUmVhZHkgPSAoKSA9PiB7XG4gICAgbGV0IGludGVydmFsO1xuICAgIGNvbnN0IGR1cmF0aW9uU2VjID0gcGxheWVyLmdldER1cmF0aW9uKCk7XG5cbiAgICBpZiAodHlwZW9mIGludGVydmFsICE9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgfVxuXG4gICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRlZFNlYyA9IHBsYXllci5nZXRDdXJyZW50VGltZSgpO1xuICAgICAgICBjb25zdCBjb21wbGV0ZWRQZXJjZW50ID0gKGNvbXBsZXRlZFNlYyAvIGR1cmF0aW9uU2VjKSAqIDEwMDtcblxuICAgICAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XG4gICAgICAgICAgICBsZWZ0OiBgJHtjb21wbGV0ZWRQZXJjZW50fSVgXG4gICAgICAgIH0pO1xuXG4gICAgfSwgMTAwMCk7XG59O1xuXG5cbmNvbnN0IG9uUGxheWVyU3RhdGVDaGFuZ2UgPSBldmVudCA9PiB7XG4gICAgc3dpdGNoKGV2ZW50LmRhdGEpe1xuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICBwbGF5ZXJDb250YWluZXIuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICAgICAgICBwbGF5ZXJTdGFydC5hZGRDbGFzcyhcInBsYXllci0tcGF1c2VkXCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIHBsYXllckNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgICAgICAgIHBsYXllclN0YXJ0LnJlbW92ZUNsYXNzKFwicGxheWVyLS1wYXVzZWRcIik7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG9uWW91VHViZUlmcmFtZUFQSVJlYWR5KCkge1xuICAgIHBsYXllciA9IG5ldyBZVC5QbGF5ZXIoJ3l0LXBsYXllcicsIHtcbiAgICAgICAgaGVpZ2h0OiAnNDA1JyxcbiAgICAgICAgd2lkdGg6ICc2NjAnLFxuICAgICAgICB2aWRlb0lkOiAnTFhiM0VLV3NJblEnLFxuICAgICAgICBldmVudHM6e1xuICAgICAgICAgICAgJ29uUmVhZHknOiBvblBsYXllclJlYWR5LFxuICAgICAgICAgICAgJ29uU3RhdGVDaGFuZ2UnOiBvblBsYXllclN0YXRlQ2hhbmdlXG4gICAgICAgIH0sXG4gICAgICAgIHBsYXllclZhcnM6IHtcbiAgICAgICAgICAgIGNvbnRyb2xzOiAwLFxuICAgICAgICAgICAgZGlzYWJsZWtiOiAwLFxuICAgICAgICAgICAgc2hvd2luZm86IDAsXG4gICAgICAgICAgICByZWw6IDAsXG4gICAgICAgICAgICBhdXRvcGxheTogMCxcbiAgICAgICAgICAgIG1vZGVzYnJhbmRpbmc6IDBcbiAgICAgICAgfVxuICAgIH0pXG59O1xuXG5cbmV2ZW50c0luaXQoKTsiLCJjb25zdCBzbGlkZXIgPSAkKFwiLnNsaWRlclwiKS5ieFNsaWRlcih7XG4gIHBhZ2VyOiBmYWxzZSxcbiAgY29udHJvbHM6IGZhbHNlXG59KTtcblxuJChcIi5hcnJvdy1sZWZ0XCIpLmNsaWNrKChlKSA9PiB7XG5cbiAgc2xpZGVyLmdvVG9QcmV2U2xpZGUoKTtcblxufSk7XG5cbiQoXCIuYXJyb3ctcmlnaHRcIikuY2xpY2soKGUpID0+IHtcblxuICBzbGlkZXIuZ29Ub05leHRTbGlkZSgpO1xuXG59KTsiLCJjb25zdCBmaW5kQmxvY2tCeUFsaWFzID0gKGFsaWFzKSA9PiB7XG4gIHJldHVybiAkKFwiLnJldmlld3MtaXRlbVwiKS5maWx0ZXIoKG5keCwgaXRlbSkgPT4ge1xuICAgIHJldHVybiAkKGl0ZW0pLmF0dHIoXCJkYXRhLWxpbmtlZC13aXRoXCIpID09IGFsaWFzO1xuICB9KTtcbn07XG4kKFwiLnJldmlld3Mtc3dpdGNoZXJfX2xpbmtcIikuY2xpY2soKGUpID0+IHsgXG4gIGUucHJldmVudERlZmF1bHQoKTtcblxuXG4gIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1vcGVuXCIpO1xuICBjb25zdCBpdGVtVG9TaG93ID0gZmluZEJsb2NrQnlBbGlhcyh0YXJnZXQpO1xuICBjb25zdCBjdXJJdGVtID0gJHRoaXMuY2xvc2VzdChcIi5yZXZpZXdzLXN3aXRjaGVyX19pdGVtXCIpO1xuXG5cbiAgaXRlbVRvU2hvdy5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xuICBjdXJJdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG59KTsgIl19
