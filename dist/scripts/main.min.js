const hamburger = document.querySelector(".hamburger");
const menu = document.querySelector(".opened__menu");
const close = document.querySelector(".close-icon");
const body = document.querySelector("body");

hamburger.addEventListener("click", function(event) {
  event.preventDefault();
  menu.classList.add("opened__menu--active");
  body.classList.add("noscroll");
})

close.addEventListener("click", function(event) {
  menu.classList.remove("opened__menu--active");
  body.classList.remove("noscroll");
})
;const openItem = item => {
  const container = item.closest(".team__item");
  const contentBlock = container.find(".team__content");
  const textBlock = contentBlock.find(".team__content-block");
  const reqHeight = textBlock.height();

  container.addClass("active");
  contentBlock.height(reqHeight);
};

const closeEveryItem = container => {
  const items = container.find(".team__content");
  const itemContainer = container.find(".team__item");

  itemContainer.removeClass("active");
  items.height(0);
};


$('.team__title').click (e => {
  const $this = $(e.currentTarget);
  const container = $this.closest('.team');
  const elemContainer = $this.closest(".team__item");

  if (elemContainer.hasClass("active")) {
    closeEveryItem(container);
  } else { 
    closeEveryItem(container);
    openItem($this);
  }
});;ymaps.ready(init);
let myPlacemark;
function init() {
  // Создание карты.
  let myMap = new ymaps.Map("map", {
    center: [55.754404, 37.607665],
    zoom: 13,
    controls:[]
  });
  myMap.behaviors.disable("scrollZoom");
  myPlacemark1 = new ymaps.Placemark(
    [55.784693, 37.640796],
    {
      hintContent: "Точка продажи №1"
    },
    {
      iconLayout: "default#image",
      iconImageHref: "../images/mark.png",
      iconImageSize: [46, 57]
    }
  );
  myPlacemark2 = new ymaps.Placemark(
    [55.747641, 37.604576],
    {
      hintContent: "Точка продажи №2"
    },
    {
      iconLayout: "default#image",
      iconImageHref: "../images/mark.png",
      iconImageSize: [46, 57]
    }
  );
  myPlacemark3 = new ymaps.Placemark(
    [55.762324, 37.634273],
    {
      hintContent: "Точка продажи №3"
    },
    {
      iconLayout: "default#image",
      iconImageHref: "../images/mark.png",
      iconImageSize: [46, 57]
    }
  );
  myPlacemark4 = new ymaps.Placemark(
    [55.732324, 37.594273],
    {
      hintContent: "Точка продажи №4"
    },
    {
      iconLayout: "default#image",
      iconImageHref: "../images/mark.png",
      iconImageSize: [46, 57]
    }
  );
  myMap.geoObjects.add(myPlacemark1);
  myMap.geoObjects.add(myPlacemark2);
  myMap.geoObjects.add(myPlacemark3);
  myMap.geoObjects.add(myPlacemark4);
};const mesureWidth = item => {
  let reqItemWidth = 0;
  const screenWidth = $(window).width();
  const container = item.closest(".products-menu");
  const titlesBlocks = container.find(".products-menu__title");
  const titlesWidth = titlesBlocks.width() * titlesBlocks.length;

  const textContainer = item.find(".products-menu__container");
  const paddingLeft = parseInt(textContainer.css("padding-left"));
  const paddingRight = parseInt(textContainer.css("padding-right"));

  const isMobile = window.matchMedia("(max-width: 768px)").matches;

  if (isMobile) {
    reqItemWidth = screenWidth - titlesWidth;
  } else {
    reqItemWidth = 500;  
  }

  return {
    container: reqItemWidth,
    textContainer: reqItemWidth - paddingRight - paddingLeft
  }
};

const closeEveryItemInContainer = (container) => {
  const items = container.find(".products-menu__item");
  const content = container.find (".products-menu__content");

  items.removeClass("active");
  content.width(0);
};

const openingItem = item => {
  const hiddenContent = item.find(".products-menu__content");
  const reqWidth = mesureWidth(item);
  const textBlock = item.find(".products-menu__container");

  item.addClass("active");
  hiddenContent.width(reqWidth.container);
  textBlock.width(reqWidth.textContainer);
};

$(".products-menu__title").on("click", (e) => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const item = $this.closest(".products-menu__item");
  const itemOpened = item.hasClass("active");
  const container = $this.closest(".products-menu");

  if (itemOpened) {
    closeEveryItemInContainer(container)
  } else {
    closeEveryItemInContainer(container)
    openingItem(item);
  }
});

$(".products-menu__close").on("click", (e) => {
  e.preventDefault();

  closeEveryItemInContainer($(".products-menu"));
});;const validateFields = (form, fieldsArray) => {
  
  fieldsArray.forEach((field) => {
    field.removeClass("input-error");
    if(field.val().trim()== "") {
      field.addClass("input-error");
    }
  });

  const errorFields = form.find('.input-error');

  return errorFields.length == 0;
}
$('.form').submit((e)=> {
  e.preventDefault();

  const form = $(e.currentTarget);
  const name = form.find("[name='name']");
  const phone = form.find("[name='phone']");
  const comment = form.find("[name='comment']");
  const to = form.find("[name='to']");

  const modal = $("#modal");
  const content = modal.find("modal__content")

  const isValid = validateFields(form, [name, phone, comment, to]);

  modal.removeClass("error-modal");
  
  if(isValid) {
   const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val()
      },
    });

    request.done((data) => {
      content.text(data.message);
      });

    request.fail((data) => {   
      const message = data.responseJSON.message;
      content.text(message);
      modal.addClass("error-modal");
    });

    request.always(() => {
      $.fancybox.open({
        src: "#modal",
        type: "inline",
          
      });
    });
   }
});

$('.button-close').click(e => { 
  e.preventDefault();

  const form = $(e.currentTarget);

  $.fancybox.close();
  
  $('#form')[0].reset();
});

;const sections = $("section");
const display = $(".maincontent");
const sideMenu = $(".fixed-menu");
const menuItems = sideMenu.find("fixed-menu__item");

let inScroll = false;

const countSectionPosition = sectionEq => {
  return sectionEq * -100;
}

const changeMenuThemeForSection = (sectionEq) => {
  const currentSection = sections.eq(sectionEq);
  const menuTheme = currentSection.attr("data-sidemenu-theme");
  const activeClass = "fixed-menu--shadowed";


    if (menuTheme == "black") {
      sideMenu.addClass(activeClass);
    } else {
      sideMenu.removeClass(activeClass);
    }

}

const resetActiveClassForItem = (items, itemEq, activeClass) => {
  items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
}

const performTransition = (sectionEq) => {
  if(inScroll) return;
    
  const transitionOver = 1000;
  const mouseInertiaOver = 300;

    inScroll = true;
    
    const position = countSectionPosition(sectionEq);

    changeMenuThemeForSection(sectionEq);

    display.css({
      transform: `translateY(${position}%)`,
    });

   resetActiveClassForItem(sections, sectionEq, "active");

   /*sections.eq(sectionEq).addClass("active").siblings().removeClass("active");*/

   sideMenu.find(".fixed-menu__item").eq(sectionEq).addClass("fixed-menu__item--active").siblings().removeClass("fixed-menu__item--active");

   setTimeout(() => {
    inScroll = false;
    resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");
   }, transitionOver + mouseInertiaOver);
 
};

const scrollViewport = (direction) => {
  const activeSection = sections.filter(".active"); 
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  if (direction == "next" && nextSection.length) {
    performTransition(nextSection.index());
  }

  if (direction == "prev" && prevSection.length) {
    performTransition(prevSection.index());
  }
};

$(window).on("wheel", (e) => {
  const deltaY = e.originalEvent.deltaY;

  if (deltaY > 0) {
    
    scrollViewport("next");
  }

  if (deltaY < 0) {

    scrollViewport("prev");
  }
});

$(window).on("keydown", (e) => {

  const tagName = e.target.tagName.toLowerCase();
  const userTypingInputs = tagName == "input" || tagName == "textarea";

  if (userTypingInputs) return; 
    switch (e.keyCode) {
      case 38:
        scrollViewport("prev");
        break;
    
        case 40:
        scrollViewport("next");
        break;
   }
});

$("[data-scroll-to]").click(e =>{
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr("data-scroll-to");
  const reqSection = $(`[data-section-id=${target}]`);

  performTransition(reqSection.index());


});;let player;
function onYouTubeIframeAPIReady() {
  player = new YT.Player("yt-player", {
    height: "370",
    width: "660",
    videoId: "awtmTJW9ic8",
    playerVars: {
      controls: 0,
      disablekb: 0,
      showinfo: 0,
      rel: 0,
      autoplay: 0,
      modestbranding: 0
    },
    events: {
      onReady: onPlayerReady,
      onStateChange: onPlayerStateChange
    }
  });
}

function onPlayerStateChange(event) {
  const playerButton = $(".player__start");
  switch (event.data) {
    case 1:
      $(".player__wrapper").addClass("player__wrapper--active");
      playerButton.addClass("paused");
      break;
    case 2:
      playerButton.removeClass("paused");
      break;
  }
}

function onPlayerReady() {
  const duration = player.getDuration();
  let interval;

  clearInterval(interval);

  interval = setInterval(() => {
    const completedSeconds = player.getCurrentTime();
    const percent = (completedSeconds / duration) * 100;

    $(".player__playback-button").css({
      left: `${percent}%`
    });
  }, 1000);
}

$(".player__start").on("click", e => {
  const btn = $(e.currentTarget);

  if (btn.hasClass("paused")) {
    player.pauseVideo();
  } else {
    player.playVideo();
  }
});

$(".player__duration-line").on("click", e => {
  e.preventDefault();
  const bar = $(e.currentTarget);
  const newButtonPosition = e.pageX - bar.offset().left;
  const clickedPercent = (newButtonPosition / bar.width()) * 100;
  const newPlayerTime = (player.getDuration() / 100) * clickedPercent;

  $(".player__playback-button").css({
    left: `${clickedPercent}%`
  });

  player.seekTo(newPlayerTime);
});

$(".player__splash").on("click", e => {
  player.playVideo();
});

// sound
setTimeout(function() {
  const volBtn = $(".player__volume-button");
  const posVolBtnPx = volBtn.css("left");
  const posVolBtn = parseInt(posVolBtnPx);
  const volBar = document.querySelector(".player__volume-line");
  const volBarStyle = getComputedStyle(volBar);
  const volBarWidth = parseInt(volBarStyle.width);

  const posVolumePercent = (posVolBtn / volBarWidth) * 100;
  console.log(posVolumePercent);
  player.setVolume(posVolumePercent);

  $(".player__volume-line").on("click", e => {
    e.preventDefault();
    const barVol = $(e.currentTarget);
    const newButtonVolPosition = e.pageX - barVol.offset().left;
    const clickedVolPercent = (newButtonVolPosition / barVol.width()) * 100;

    if (clickedVolPercent < 100) {
      $(".player__volume-button").css({
        left: `${clickedVolPercent}%`
      });
    } else {
      $(".player__volume-button").css({
        left: `100%`
      });
    }

    player.unMute();
    player.setVolume(clickedVolPercent);
  });

  $(".player__volume-pic").on("click", e => {
    if (player.isMuted()) {
      player.unMute();
      $(".player__volume-button").css({
        left: `${posVolumePercent}%`
      });
      player.setVolume(posVolumePercent);
    } else {
      player.mute();
      $(".player__volume-button").css({
        left: 0
      });
    }
  });
}, 2000);;const slider = $(".slider").bxSlider({
  pager: false,
  controls: false
});

$(".arrow-left").click((e) => {

  slider.goToPrevSlide();

});

$(".arrow-right").click((e) => {

  slider.goToNextSlide();

});;const findBlockByAlias = (alias) => {
  return $(".reviews-item").filter((ndx, item) => {
    return $(item).attr("data-linked-with") == alias;
  });
};
$(".reviews-switcher__link").click((e) => { 
  e.preventDefault();


  const $this = $(e.currentTarget);
  const target = $this.attr("data-open");
  const itemToShow = findBlockByAlias(target);
  const curItem = $this.closest(".reviews-switcher__item");


  itemToShow.addClass("active").siblings().removeClass("active");
  curItem.addClass("active").siblings().removeClass("active");
}); 
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjEuanMiLCJhY2NvLmpzIiwibWFwLmpzIiwibWVudS1hY2NvLmpzIiwibW9kYWwuanMiLCJvcHMuanMiLCJwbGF5ZXIuanMiLCJzbGlkZXIuanMiLCJ0YWJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUM5QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQy9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N2RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElDakhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQzdIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGhhbWJ1cmdlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaGFtYnVyZ2VyXCIpO1xuY29uc3QgbWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3BlbmVkX19tZW51XCIpO1xuY29uc3QgY2xvc2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNsb3NlLWljb25cIik7XG5jb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImJvZHlcIik7XG5cbmhhbWJ1cmdlci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgbWVudS5jbGFzc0xpc3QuYWRkKFwib3BlbmVkX19tZW51LS1hY3RpdmVcIik7XG4gIGJvZHkuY2xhc3NMaXN0LmFkZChcIm5vc2Nyb2xsXCIpO1xufSlcblxuY2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gIG1lbnUuY2xhc3NMaXN0LnJlbW92ZShcIm9wZW5lZF9fbWVudS0tYWN0aXZlXCIpO1xuICBib2R5LmNsYXNzTGlzdC5yZW1vdmUoXCJub3Njcm9sbFwiKTtcbn0pXG4iLCJjb25zdCBvcGVuSXRlbSA9IGl0ZW0gPT4ge1xuICBjb25zdCBjb250YWluZXIgPSBpdGVtLmNsb3Nlc3QoXCIudGVhbV9faXRlbVwiKTtcbiAgY29uc3QgY29udGVudEJsb2NrID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9fY29udGVudFwiKTtcbiAgY29uc3QgdGV4dEJsb2NrID0gY29udGVudEJsb2NrLmZpbmQoXCIudGVhbV9fY29udGVudC1ibG9ja1wiKTtcbiAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpO1xuXG4gIGNvbnRhaW5lci5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpO1xufTtcblxuY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSBjb250YWluZXIgPT4ge1xuICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2NvbnRlbnRcIik7XG4gIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19pdGVtXCIpO1xuXG4gIGl0ZW1Db250YWluZXIucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XG4gIGl0ZW1zLmhlaWdodCgwKTtcbn07XG5cblxuJCgnLnRlYW1fX3RpdGxlJykuY2xpY2sgKGUgPT4ge1xuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnRlYW0nKTtcbiAgY29uc3QgZWxlbUNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIudGVhbV9faXRlbVwiKTtcblxuICBpZiAoZWxlbUNvbnRhaW5lci5oYXNDbGFzcyhcImFjdGl2ZVwiKSkge1xuICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XG4gIH0gZWxzZSB7IFxuICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XG4gICAgb3Blbkl0ZW0oJHRoaXMpO1xuICB9XG59KTsiLCJ5bWFwcy5yZWFkeShpbml0KTtcbmxldCBteVBsYWNlbWFyaztcbmZ1bmN0aW9uIGluaXQoKSB7XG4gIC8vINCh0L7Qt9C00LDQvdC40LUg0LrQsNGA0YLRiy5cbiAgbGV0IG15TWFwID0gbmV3IHltYXBzLk1hcChcIm1hcFwiLCB7XG4gICAgY2VudGVyOiBbNTUuNzU0NDA0LCAzNy42MDc2NjVdLFxuICAgIHpvb206IDEzLFxuICAgIGNvbnRyb2xzOltdXG4gIH0pO1xuICBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZShcInNjcm9sbFpvb21cIik7XG4gIG15UGxhY2VtYXJrMSA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoXG4gICAgWzU1Ljc4NDY5MywgMzcuNjQwNzk2XSxcbiAgICB7XG4gICAgICBoaW50Q29udGVudDogXCLQotC+0YfQutCwINC/0YDQvtC00LDQttC4IOKEljFcIlxuICAgIH0sXG4gICAge1xuICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXG4gICAgICBpY29uSW1hZ2VIcmVmOiBcIi4uL2ltYWdlcy9tYXJrLnBuZ1wiLFxuICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N11cbiAgICB9XG4gICk7XG4gIG15UGxhY2VtYXJrMiA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoXG4gICAgWzU1Ljc0NzY0MSwgMzcuNjA0NTc2XSxcbiAgICB7XG4gICAgICBoaW50Q29udGVudDogXCLQotC+0YfQutCwINC/0YDQvtC00LDQttC4IOKEljJcIlxuICAgIH0sXG4gICAge1xuICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXG4gICAgICBpY29uSW1hZ2VIcmVmOiBcIi4uL2ltYWdlcy9tYXJrLnBuZ1wiLFxuICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N11cbiAgICB9XG4gICk7XG4gIG15UGxhY2VtYXJrMyA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoXG4gICAgWzU1Ljc2MjMyNCwgMzcuNjM0MjczXSxcbiAgICB7XG4gICAgICBoaW50Q29udGVudDogXCLQotC+0YfQutCwINC/0YDQvtC00LDQttC4IOKEljNcIlxuICAgIH0sXG4gICAge1xuICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXG4gICAgICBpY29uSW1hZ2VIcmVmOiBcIi4uL2ltYWdlcy9tYXJrLnBuZ1wiLFxuICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N11cbiAgICB9XG4gICk7XG4gIG15UGxhY2VtYXJrNCA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoXG4gICAgWzU1LjczMjMyNCwgMzcuNTk0MjczXSxcbiAgICB7XG4gICAgICBoaW50Q29udGVudDogXCLQotC+0YfQutCwINC/0YDQvtC00LDQttC4IOKEljRcIlxuICAgIH0sXG4gICAge1xuICAgICAgaWNvbkxheW91dDogXCJkZWZhdWx0I2ltYWdlXCIsXG4gICAgICBpY29uSW1hZ2VIcmVmOiBcIi4uL2ltYWdlcy9tYXJrLnBuZ1wiLFxuICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N11cbiAgICB9XG4gICk7XG4gIG15TWFwLmdlb09iamVjdHMuYWRkKG15UGxhY2VtYXJrMSk7XG4gIG15TWFwLmdlb09iamVjdHMuYWRkKG15UGxhY2VtYXJrMik7XG4gIG15TWFwLmdlb09iamVjdHMuYWRkKG15UGxhY2VtYXJrMyk7XG4gIG15TWFwLmdlb09iamVjdHMuYWRkKG15UGxhY2VtYXJrNCk7XG59IiwiY29uc3QgbWVzdXJlV2lkdGggPSBpdGVtID0+IHtcbiAgbGV0IHJlcUl0ZW1XaWR0aCA9IDA7XG4gIGNvbnN0IHNjcmVlbldpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XG4gIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi5wcm9kdWN0cy1tZW51XCIpO1xuICBjb25zdCB0aXRsZXNCbG9ja3MgPSBjb250YWluZXIuZmluZChcIi5wcm9kdWN0cy1tZW51X190aXRsZVwiKTtcbiAgY29uc3QgdGl0bGVzV2lkdGggPSB0aXRsZXNCbG9ja3Mud2lkdGgoKSAqIHRpdGxlc0Jsb2Nrcy5sZW5ndGg7XG5cbiAgY29uc3QgdGV4dENvbnRhaW5lciA9IGl0ZW0uZmluZChcIi5wcm9kdWN0cy1tZW51X19jb250YWluZXJcIik7XG4gIGNvbnN0IHBhZGRpbmdMZWZ0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoXCJwYWRkaW5nLWxlZnRcIikpO1xuICBjb25zdCBwYWRkaW5nUmlnaHQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcyhcInBhZGRpbmctcmlnaHRcIikpO1xuXG4gIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA3NjhweClcIikubWF0Y2hlcztcblxuICBpZiAoaXNNb2JpbGUpIHtcbiAgICByZXFJdGVtV2lkdGggPSBzY3JlZW5XaWR0aCAtIHRpdGxlc1dpZHRoO1xuICB9IGVsc2Uge1xuICAgIHJlcUl0ZW1XaWR0aCA9IDUwMDsgIFxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBjb250YWluZXI6IHJlcUl0ZW1XaWR0aCxcbiAgICB0ZXh0Q29udGFpbmVyOiByZXFJdGVtV2lkdGggLSBwYWRkaW5nUmlnaHQgLSBwYWRkaW5nTGVmdFxuICB9XG59O1xuXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyID0gKGNvbnRhaW5lcikgPT4ge1xuICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLnByb2R1Y3RzLW1lbnVfX2l0ZW1cIik7XG4gIGNvbnN0IGNvbnRlbnQgPSBjb250YWluZXIuZmluZCAoXCIucHJvZHVjdHMtbWVudV9fY29udGVudFwiKTtcblxuICBpdGVtcy5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgY29udGVudC53aWR0aCgwKTtcbn07XG5cbmNvbnN0IG9wZW5pbmdJdGVtID0gaXRlbSA9PiB7XG4gIGNvbnN0IGhpZGRlbkNvbnRlbnQgPSBpdGVtLmZpbmQoXCIucHJvZHVjdHMtbWVudV9fY29udGVudFwiKTtcbiAgY29uc3QgcmVxV2lkdGggPSBtZXN1cmVXaWR0aChpdGVtKTtcbiAgY29uc3QgdGV4dEJsb2NrID0gaXRlbS5maW5kKFwiLnByb2R1Y3RzLW1lbnVfX2NvbnRhaW5lclwiKTtcblxuICBpdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICBoaWRkZW5Db250ZW50LndpZHRoKHJlcVdpZHRoLmNvbnRhaW5lcik7XG4gIHRleHRCbG9jay53aWR0aChyZXFXaWR0aC50ZXh0Q29udGFpbmVyKTtcbn07XG5cbiQoXCIucHJvZHVjdHMtbWVudV9fdGl0bGVcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XG4gIGNvbnN0IGl0ZW0gPSAkdGhpcy5jbG9zZXN0KFwiLnByb2R1Y3RzLW1lbnVfX2l0ZW1cIik7XG4gIGNvbnN0IGl0ZW1PcGVuZWQgPSBpdGVtLmhhc0NsYXNzKFwiYWN0aXZlXCIpO1xuICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnByb2R1Y3RzLW1lbnVcIik7XG5cbiAgaWYgKGl0ZW1PcGVuZWQpIHtcbiAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKGNvbnRhaW5lcilcbiAgfSBlbHNlIHtcbiAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKGNvbnRhaW5lcilcbiAgICBvcGVuaW5nSXRlbShpdGVtKTtcbiAgfVxufSk7XG5cbiQoXCIucHJvZHVjdHMtbWVudV9fY2xvc2VcIikub24oXCJjbGlja1wiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY2xvc2VFdmVyeUl0ZW1JbkNvbnRhaW5lcigkKFwiLnByb2R1Y3RzLW1lbnVcIikpO1xufSk7IiwiY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcbiAgXG4gIGZpZWxkc0FycmF5LmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgZmllbGQucmVtb3ZlQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcbiAgICBpZihmaWVsZC52YWwoKS50cmltKCk9PSBcIlwiKSB7XG4gICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgZXJyb3JGaWVsZHMgPSBmb3JtLmZpbmQoJy5pbnB1dC1lcnJvcicpO1xuXG4gIHJldHVybiBlcnJvckZpZWxkcy5sZW5ndGggPT0gMDtcbn1cbiQoJy5mb3JtJykuc3VibWl0KChlKT0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IGZvcm0gPSAkKGUuY3VycmVudFRhcmdldCk7XG4gIGNvbnN0IG5hbWUgPSBmb3JtLmZpbmQoXCJbbmFtZT0nbmFtZSddXCIpO1xuICBjb25zdCBwaG9uZSA9IGZvcm0uZmluZChcIltuYW1lPSdwaG9uZSddXCIpO1xuICBjb25zdCBjb21tZW50ID0gZm9ybS5maW5kKFwiW25hbWU9J2NvbW1lbnQnXVwiKTtcbiAgY29uc3QgdG8gPSBmb3JtLmZpbmQoXCJbbmFtZT0ndG8nXVwiKTtcblxuICBjb25zdCBtb2RhbCA9ICQoXCIjbW9kYWxcIik7XG4gIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwibW9kYWxfX2NvbnRlbnRcIilcblxuICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xuXG4gIG1vZGFsLnJlbW92ZUNsYXNzKFwiZXJyb3ItbW9kYWxcIik7XG4gIFxuICBpZihpc1ZhbGlkKSB7XG4gICBjb25zdCByZXF1ZXN0ID0gJC5hamF4KHtcbiAgICAgIHVybDogXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcbiAgICAgIG1ldGhvZDogXCJwb3N0XCIsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG5hbWU6IG5hbWUudmFsKCksXG4gICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcbiAgICAgICAgY29tbWVudDogY29tbWVudC52YWwoKSxcbiAgICAgICAgdG86IHRvLnZhbCgpXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmVxdWVzdC5kb25lKChkYXRhKSA9PiB7XG4gICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcbiAgICAgIH0pO1xuXG4gICAgcmVxdWVzdC5mYWlsKChkYXRhKSA9PiB7ICAgXG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcbiAgICAgIGNvbnRlbnQudGV4dChtZXNzYWdlKTtcbiAgICAgIG1vZGFsLmFkZENsYXNzKFwiZXJyb3ItbW9kYWxcIik7XG4gICAgfSk7XG5cbiAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XG4gICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xuICAgICAgICBzcmM6IFwiI21vZGFsXCIsXG4gICAgICAgIHR5cGU6IFwiaW5saW5lXCIsXG4gICAgICAgICAgXG4gICAgICB9KTtcbiAgICB9KTtcbiAgIH1cbn0pO1xuXG4kKCcuYnV0dG9uLWNsb3NlJykuY2xpY2soZSA9PiB7IFxuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcblxuICAkLmZhbmN5Ym94LmNsb3NlKCk7XG4gIFxuICAkKCcjZm9ybScpWzBdLnJlc2V0KCk7XG59KTtcblxuIiwiY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xuY29uc3Qgc2lkZU1lbnUgPSAkKFwiLmZpeGVkLW1lbnVcIik7XG5jb25zdCBtZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKFwiZml4ZWQtbWVudV9faXRlbVwiKTtcblxubGV0IGluU2Nyb2xsID0gZmFsc2U7XG5cbmNvbnN0IGNvdW50U2VjdGlvblBvc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcbiAgcmV0dXJuIHNlY3Rpb25FcSAqIC0xMDA7XG59XG5cbmNvbnN0IGNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24gPSAoc2VjdGlvbkVxKSA9PiB7XG4gIGNvbnN0IGN1cnJlbnRTZWN0aW9uID0gc2VjdGlvbnMuZXEoc2VjdGlvbkVxKTtcbiAgY29uc3QgbWVudVRoZW1lID0gY3VycmVudFNlY3Rpb24uYXR0cihcImRhdGEtc2lkZW1lbnUtdGhlbWVcIik7XG4gIGNvbnN0IGFjdGl2ZUNsYXNzID0gXCJmaXhlZC1tZW51LS1zaGFkb3dlZFwiO1xuXG5cbiAgICBpZiAobWVudVRoZW1lID09IFwiYmxhY2tcIikge1xuICAgICAgc2lkZU1lbnUuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaWRlTWVudS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XG4gICAgfVxuXG59XG5cbmNvbnN0IHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtID0gKGl0ZW1zLCBpdGVtRXEsIGFjdGl2ZUNsYXNzKSA9PiB7XG4gIGl0ZW1zLmVxKGl0ZW1FcSkuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpO1xufVxuXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcbiAgaWYoaW5TY3JvbGwpIHJldHVybjtcbiAgICBcbiAgY29uc3QgdHJhbnNpdGlvbk92ZXIgPSAxMDAwO1xuICBjb25zdCBtb3VzZUluZXJ0aWFPdmVyID0gMzAwO1xuXG4gICAgaW5TY3JvbGwgPSB0cnVlO1xuICAgIFxuICAgIGNvbnN0IHBvc2l0aW9uID0gY291bnRTZWN0aW9uUG9zaXRpb24oc2VjdGlvbkVxKTtcblxuICAgIGNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24oc2VjdGlvbkVxKTtcblxuICAgIGRpc3BsYXkuY3NzKHtcbiAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0lKWAsXG4gICAgfSk7XG5cbiAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKHNlY3Rpb25zLCBzZWN0aW9uRXEsIFwiYWN0aXZlXCIpO1xuXG4gICAvKnNlY3Rpb25zLmVxKHNlY3Rpb25FcSkuYWRkQ2xhc3MoXCJhY3RpdmVcIikuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTsqL1xuXG4gICBzaWRlTWVudS5maW5kKFwiLmZpeGVkLW1lbnVfX2l0ZW1cIikuZXEoc2VjdGlvbkVxKS5hZGRDbGFzcyhcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpO1xuXG4gICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICBpblNjcm9sbCA9IGZhbHNlO1xuICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCBcImZpeGVkLW1lbnVfX2l0ZW0tLWFjdGl2ZVwiKTtcbiAgIH0sIHRyYW5zaXRpb25PdmVyICsgbW91c2VJbmVydGlhT3Zlcik7XG4gXG59O1xuXG5jb25zdCBzY3JvbGxWaWV3cG9ydCA9IChkaXJlY3Rpb24pID0+IHtcbiAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcihcIi5hY3RpdmVcIik7IFxuICBjb25zdCBuZXh0U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ubmV4dCgpO1xuICBjb25zdCBwcmV2U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ucHJldigpO1xuXG4gIGlmIChkaXJlY3Rpb24gPT0gXCJuZXh0XCIgJiYgbmV4dFNlY3Rpb24ubGVuZ3RoKSB7XG4gICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSk7XG4gIH1cblxuICBpZiAoZGlyZWN0aW9uID09IFwicHJldlwiICYmIHByZXZTZWN0aW9uLmxlbmd0aCkge1xuICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xuICB9XG59O1xuXG4kKHdpbmRvdykub24oXCJ3aGVlbFwiLCAoZSkgPT4ge1xuICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xuXG4gIGlmIChkZWx0YVkgPiAwKSB7XG4gICAgXG4gICAgc2Nyb2xsVmlld3BvcnQoXCJuZXh0XCIpO1xuICB9XG5cbiAgaWYgKGRlbHRhWSA8IDApIHtcblxuICAgIHNjcm9sbFZpZXdwb3J0KFwicHJldlwiKTtcbiAgfVxufSk7XG5cbiQod2luZG93KS5vbihcImtleWRvd25cIiwgKGUpID0+IHtcblxuICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCB1c2VyVHlwaW5nSW5wdXRzID0gdGFnTmFtZSA9PSBcImlucHV0XCIgfHwgdGFnTmFtZSA9PSBcInRleHRhcmVhXCI7XG5cbiAgaWYgKHVzZXJUeXBpbmdJbnB1dHMpIHJldHVybjsgXG4gICAgc3dpdGNoIChlLmtleUNvZGUpIHtcbiAgICAgIGNhc2UgMzg6XG4gICAgICAgIHNjcm9sbFZpZXdwb3J0KFwicHJldlwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgXG4gICAgICAgIGNhc2UgNDA6XG4gICAgICAgIHNjcm9sbFZpZXdwb3J0KFwibmV4dFwiKTtcbiAgICAgICAgYnJlYWs7XG4gICB9XG59KTtcblxuJChcIltkYXRhLXNjcm9sbC10b11cIikuY2xpY2soZSA9PntcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIik7XG4gIGNvbnN0IHJlcVNlY3Rpb24gPSAkKGBbZGF0YS1zZWN0aW9uLWlkPSR7dGFyZ2V0fV1gKTtcblxuICBwZXJmb3JtVHJhbnNpdGlvbihyZXFTZWN0aW9uLmluZGV4KCkpO1xuXG5cbn0pOyIsImxldCBwbGF5ZXI7XG5mdW5jdGlvbiBvbllvdVR1YmVJZnJhbWVBUElSZWFkeSgpIHtcbiAgcGxheWVyID0gbmV3IFlULlBsYXllcihcInl0LXBsYXllclwiLCB7XG4gICAgaGVpZ2h0OiBcIjM3MFwiLFxuICAgIHdpZHRoOiBcIjY2MFwiLFxuICAgIHZpZGVvSWQ6IFwiYXd0bVRKVzlpYzhcIixcbiAgICBwbGF5ZXJWYXJzOiB7XG4gICAgICBjb250cm9sczogMCxcbiAgICAgIGRpc2FibGVrYjogMCxcbiAgICAgIHNob3dpbmZvOiAwLFxuICAgICAgcmVsOiAwLFxuICAgICAgYXV0b3BsYXk6IDAsXG4gICAgICBtb2Rlc3RicmFuZGluZzogMFxuICAgIH0sXG4gICAgZXZlbnRzOiB7XG4gICAgICBvblJlYWR5OiBvblBsYXllclJlYWR5LFxuICAgICAgb25TdGF0ZUNoYW5nZTogb25QbGF5ZXJTdGF0ZUNoYW5nZVxuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG9uUGxheWVyU3RhdGVDaGFuZ2UoZXZlbnQpIHtcbiAgY29uc3QgcGxheWVyQnV0dG9uID0gJChcIi5wbGF5ZXJfX3N0YXJ0XCIpO1xuICBzd2l0Y2ggKGV2ZW50LmRhdGEpIHtcbiAgICBjYXNlIDE6XG4gICAgICAkKFwiLnBsYXllcl9fd3JhcHBlclwiKS5hZGRDbGFzcyhcInBsYXllcl9fd3JhcHBlci0tYWN0aXZlXCIpO1xuICAgICAgcGxheWVyQnV0dG9uLmFkZENsYXNzKFwicGF1c2VkXCIpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAyOlxuICAgICAgcGxheWVyQnV0dG9uLnJlbW92ZUNsYXNzKFwicGF1c2VkXCIpO1xuICAgICAgYnJlYWs7XG4gIH1cbn1cblxuZnVuY3Rpb24gb25QbGF5ZXJSZWFkeSgpIHtcbiAgY29uc3QgZHVyYXRpb24gPSBwbGF5ZXIuZ2V0RHVyYXRpb24oKTtcbiAgbGV0IGludGVydmFsO1xuXG4gIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuXG4gIGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgIGNvbnN0IGNvbXBsZXRlZFNlY29uZHMgPSBwbGF5ZXIuZ2V0Q3VycmVudFRpbWUoKTtcbiAgICBjb25zdCBwZXJjZW50ID0gKGNvbXBsZXRlZFNlY29uZHMgLyBkdXJhdGlvbikgKiAxMDA7XG5cbiAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XG4gICAgICBsZWZ0OiBgJHtwZXJjZW50fSVgXG4gICAgfSk7XG4gIH0sIDEwMDApO1xufVxuXG4kKFwiLnBsYXllcl9fc3RhcnRcIikub24oXCJjbGlja1wiLCBlID0+IHtcbiAgY29uc3QgYnRuID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuXG4gIGlmIChidG4uaGFzQ2xhc3MoXCJwYXVzZWRcIikpIHtcbiAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xuICB9IGVsc2Uge1xuICAgIHBsYXllci5wbGF5VmlkZW8oKTtcbiAgfVxufSk7XG5cbiQoXCIucGxheWVyX19kdXJhdGlvbi1saW5lXCIpLm9uKFwiY2xpY2tcIiwgZSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3QgYmFyID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICBjb25zdCBuZXdCdXR0b25Qb3NpdGlvbiA9IGUucGFnZVggLSBiYXIub2Zmc2V0KCkubGVmdDtcbiAgY29uc3QgY2xpY2tlZFBlcmNlbnQgPSAobmV3QnV0dG9uUG9zaXRpb24gLyBiYXIud2lkdGgoKSkgKiAxMDA7XG4gIGNvbnN0IG5ld1BsYXllclRpbWUgPSAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogY2xpY2tlZFBlcmNlbnQ7XG5cbiAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvblwiKS5jc3Moe1xuICAgIGxlZnQ6IGAke2NsaWNrZWRQZXJjZW50fSVgXG4gIH0pO1xuXG4gIHBsYXllci5zZWVrVG8obmV3UGxheWVyVGltZSk7XG59KTtcblxuJChcIi5wbGF5ZXJfX3NwbGFzaFwiKS5vbihcImNsaWNrXCIsIGUgPT4ge1xuICBwbGF5ZXIucGxheVZpZGVvKCk7XG59KTtcblxuLy8gc291bmRcbnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gIGNvbnN0IHZvbEJ0biA9ICQoXCIucGxheWVyX192b2x1bWUtYnV0dG9uXCIpO1xuICBjb25zdCBwb3NWb2xCdG5QeCA9IHZvbEJ0bi5jc3MoXCJsZWZ0XCIpO1xuICBjb25zdCBwb3NWb2xCdG4gPSBwYXJzZUludChwb3NWb2xCdG5QeCk7XG4gIGNvbnN0IHZvbEJhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX192b2x1bWUtbGluZVwiKTtcbiAgY29uc3Qgdm9sQmFyU3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKHZvbEJhcik7XG4gIGNvbnN0IHZvbEJhcldpZHRoID0gcGFyc2VJbnQodm9sQmFyU3R5bGUud2lkdGgpO1xuXG4gIGNvbnN0IHBvc1ZvbHVtZVBlcmNlbnQgPSAocG9zVm9sQnRuIC8gdm9sQmFyV2lkdGgpICogMTAwO1xuICBjb25zb2xlLmxvZyhwb3NWb2x1bWVQZXJjZW50KTtcbiAgcGxheWVyLnNldFZvbHVtZShwb3NWb2x1bWVQZXJjZW50KTtcblxuICAkKFwiLnBsYXllcl9fdm9sdW1lLWxpbmVcIikub24oXCJjbGlja1wiLCBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgYmFyVm9sID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuICAgIGNvbnN0IG5ld0J1dHRvblZvbFBvc2l0aW9uID0gZS5wYWdlWCAtIGJhclZvbC5vZmZzZXQoKS5sZWZ0O1xuICAgIGNvbnN0IGNsaWNrZWRWb2xQZXJjZW50ID0gKG5ld0J1dHRvblZvbFBvc2l0aW9uIC8gYmFyVm9sLndpZHRoKCkpICogMTAwO1xuXG4gICAgaWYgKGNsaWNrZWRWb2xQZXJjZW50IDwgMTAwKSB7XG4gICAgICAkKFwiLnBsYXllcl9fdm9sdW1lLWJ1dHRvblwiKS5jc3Moe1xuICAgICAgICBsZWZ0OiBgJHtjbGlja2VkVm9sUGVyY2VudH0lYFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQoXCIucGxheWVyX192b2x1bWUtYnV0dG9uXCIpLmNzcyh7XG4gICAgICAgIGxlZnQ6IGAxMDAlYFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcGxheWVyLnVuTXV0ZSgpO1xuICAgIHBsYXllci5zZXRWb2x1bWUoY2xpY2tlZFZvbFBlcmNlbnQpO1xuICB9KTtcblxuICAkKFwiLnBsYXllcl9fdm9sdW1lLXBpY1wiKS5vbihcImNsaWNrXCIsIGUgPT4ge1xuICAgIGlmIChwbGF5ZXIuaXNNdXRlZCgpKSB7XG4gICAgICBwbGF5ZXIudW5NdXRlKCk7XG4gICAgICAkKFwiLnBsYXllcl9fdm9sdW1lLWJ1dHRvblwiKS5jc3Moe1xuICAgICAgICBsZWZ0OiBgJHtwb3NWb2x1bWVQZXJjZW50fSVgXG4gICAgICB9KTtcbiAgICAgIHBsYXllci5zZXRWb2x1bWUocG9zVm9sdW1lUGVyY2VudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBsYXllci5tdXRlKCk7XG4gICAgICAkKFwiLnBsYXllcl9fdm9sdW1lLWJ1dHRvblwiKS5jc3Moe1xuICAgICAgICBsZWZ0OiAwXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufSwgMjAwMCk7IiwiY29uc3Qgc2xpZGVyID0gJChcIi5zbGlkZXJcIikuYnhTbGlkZXIoe1xuICBwYWdlcjogZmFsc2UsXG4gIGNvbnRyb2xzOiBmYWxzZVxufSk7XG5cbiQoXCIuYXJyb3ctbGVmdFwiKS5jbGljaygoZSkgPT4ge1xuXG4gIHNsaWRlci5nb1RvUHJldlNsaWRlKCk7XG5cbn0pO1xuXG4kKFwiLmFycm93LXJpZ2h0XCIpLmNsaWNrKChlKSA9PiB7XG5cbiAgc2xpZGVyLmdvVG9OZXh0U2xpZGUoKTtcblxufSk7IiwiY29uc3QgZmluZEJsb2NrQnlBbGlhcyA9IChhbGlhcykgPT4ge1xuICByZXR1cm4gJChcIi5yZXZpZXdzLWl0ZW1cIikuZmlsdGVyKChuZHgsIGl0ZW0pID0+IHtcbiAgICByZXR1cm4gJChpdGVtKS5hdHRyKFwiZGF0YS1saW5rZWQtd2l0aFwiKSA9PSBhbGlhcztcbiAgfSk7XG59O1xuJChcIi5yZXZpZXdzLXN3aXRjaGVyX19saW5rXCIpLmNsaWNrKChlKSA9PiB7IFxuICBlLnByZXZlbnREZWZhdWx0KCk7XG5cblxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcbiAgY29uc3QgaXRlbVRvU2hvdyA9IGZpbmRCbG9ja0J5QWxpYXModGFyZ2V0KTtcbiAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIucmV2aWV3cy1zd2l0Y2hlcl9faXRlbVwiKTtcblxuXG4gIGl0ZW1Ub1Nob3cuYWRkQ2xhc3MoXCJhY3RpdmVcIikuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcImFjdGl2ZVwiKTtcbiAgY3VySXRlbS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xufSk7ICJdfQ==
